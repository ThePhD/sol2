language: cpp

git:
    depth: 5

addons: 
  apt:
    sources: &sources
    - ubuntu-toolchain-r-test # cmake requirement
    - llvm-toolchain-precise-3.5
    - llvm-toolchain-precise-3.6
    - george-edison55-precise-backports
    
    packages: &core-pkgs
    - [cmake, cmake-data]
    - ninja-build
    
    packages: &gcc-49
    - *core-pkgs
    - [gcc-4.9, g++-4.9]

    packages: &gcc-5
    - *core-pkgs
    - [gcc-5, g++-5]

    packages: &clang-36
    - *core-pkgs
    - clang-3.6

    packages: &luajit 
    - libluajit-5.1-dev

    packages: &lua52 
    - liblua5.2-dev

matrix:
  include: 
    - os: linux
      env: COMPILER=g++-4.9 LUA_VERSION=lua52
      compiler: gcc
      addons:
        apt:
          sources:
          - *sources
          packages:
          - *gcc-49
          - *lua52

    # gcc-5
    - os: linux
      env: COMPILER=g++-4.9 LUA_VERSION=luajit51
      compiler: gcc
      addons:
        apt:
          sources:
          - *sources
          packages:
          - *gcc-49
          - *luajit

    # gcc-5
    - os: linux
      env: COMPILER=g++-5 LUA_VERSION=lua52
      compiler: gcc
      addons:
        apt:
          sources:
          - *sources
          packages:
          - *gcc-5
          - *lua52

    # gcc-5
    - os: linux
      env: COMPILER=g++-5 LUA_VERSION=luajit51
      compiler: gcc
      addons:
        apt:
          sources:
          - *sources
          packages:
          - *gcc-5
          - *luajit

    # clang
    - os: linux
      env: COMPILER=clang++-3.6 LUA_VERSION=lua52
      compiler: clang
      addons:
        apt:
          sources:
          - *sources
          packages:
          - *clang-36
          - *lua52

    - os: linux
      env: COMPILER=clang++-3.6 LUA_VERSION=luajit51
      compiler: clang
      addons:
        apt:
          sources:
          - *sources
          packages:
          - *clang-36
          - *luajit

    - os: osx
      osx_image: xcode7
      compiler: gcc
      env: COMPILER=g++-4.9 LUA_VERSION=lua53

    - os: osx
      osx_image: xcode7
      compiler: gcc
      env: COMPILER=g++-5 LUA_VERSION=luajit51

    - os: osx
      osx_image: xcode7
      compiler: clang
      env: COMPILER=appleclang LUA_VERSION=lua53

  allow_failures:
    - os: osx
      compiler: clang 

before_install:
- source ./install.deps.sh

install:
- install_os_deps

script:
- echo "Configuration info:"
- export_compiler_vars
- ninja --version
- mkdir build; cd build;
- cmake .. -DSOL2_LUA_VERSION=${LUA_VERSION} -G Ninja && ninja check # This should also do examples..

notifications:
    email:
        on_success: change
        on_failure: change
